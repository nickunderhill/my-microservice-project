# üöÄ Terraform Infrastructure Project - Lesson 7

–¶–µ–π –ø—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è AWS —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Terraform –∑
–≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º –º–æ–¥—É–ª—å–Ω–æ—ó –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏.

## üìã –ó–º—ñ—Å—Ç

- [–û–≥–ª—è–¥ –ø—Ä–æ–µ–∫—Ç—É](#–æ–≥–ª—è–¥-–ø—Ä–æ–µ–∫—Ç—É)
- [–ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞)
- [–ú–æ–¥—É–ª—ñ](#–º–æ–¥—É–ª—ñ)
- [–ü–µ—Ä–µ–¥—É–º–æ–≤–∏](#–ø–µ—Ä–µ–¥—É–º–æ–≤–∏)
- [–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è](#–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è-—Ç–∞-–Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è)
- [–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è](#–≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç—É)
- [–í–∏—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ](#–≤–∏—Ö—ñ–¥–Ω—ñ-–¥–∞–Ω—ñ)
- [–ë–µ–∑–ø–µ–∫–∞](#–±–µ–∑–ø–µ–∫–∞)
- [–ü—ñ–¥—Ç—Ä–∏–º–∫–∞](#–ø—ñ–¥—Ç—Ä–∏–º–∫–∞)

## üéØ –û–≥–ª—è–¥ –ø—Ä–æ–µ–∫—Ç—É

–¶–µ–π –ø—Ä–æ–µ–∫—Ç —Å—Ç–≤–æ—Ä—é—î –ø–æ–≤–Ω—É AWS —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –º—ñ–∫—Ä–æ—Å–µ—Ä–≤—ñ—Å–Ω–æ–≥–æ –¥–æ–¥–∞—Ç–∫—É,
–≤–∫–ª—é—á–∞—é—á–∏:

- **VPC** –∑ –ø—É–±–ª—ñ—á–Ω–∏–º–∏ —Ç–∞ –ø—Ä–∏–≤–∞—Ç–Ω–∏–º–∏ –ø—ñ–¥–º–µ—Ä–µ–∂–∞–º–∏
- **ECR —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π** –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è Docker –æ–±—Ä–∞–∑—ñ–≤
- **S3 –±–∞–∫–µ—Ç** –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è Terraform —Å—Ç–∞–Ω—É
- **DynamoDB —Ç–∞–±–ª–∏—Ü—é** –¥–ª—è –±–ª–æ–∫—É–≤–∞–Ω–Ω—è —Å—Ç–∞–Ω—É

## üèóÔ∏è –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   VPC Module     ‚îÇ    ‚îÇ   ECR Module    ‚îÇ    ‚îÇ S3 Backend      ‚îÇ
‚îÇ                  ‚îÇ    ‚îÇ                 ‚îÇ    ‚îÇ Module          ‚îÇ
‚îÇ ‚Ä¢ VPC            ‚îÇ    ‚îÇ ‚Ä¢ Repository    ‚îÇ    ‚îÇ ‚Ä¢ S3 Bucket     ‚îÇ
‚îÇ ‚Ä¢ Public Subnets ‚îÇ    ‚îÇ ‚Ä¢ Image Scanning‚îÇ    ‚îÇ ‚Ä¢ DynamoDB      ‚îÇ
‚îÇ ‚Ä¢ Private Subnets‚îÇ    ‚îÇ ‚Ä¢ Access Policy ‚îÇ    ‚îÇ ‚Ä¢ State Locking ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üì¶ –ú–æ–¥—É–ª—ñ

### 1. **VPC Module** (`./modules/vpc`)

–°—Ç–≤–æ—Ä—é—î –≤—ñ—Ä—Ç—É–∞–ª—å–Ω—É –ø—Ä–∏–≤–∞—Ç–Ω—É —Ö–º–∞—Ä—É –∑:

- –ü—É–±–ª—ñ—á–Ω–∏–º–∏ –ø—ñ–¥–º–µ—Ä–µ–∂–∞–º–∏ (3 AZ)
- –ü—Ä–∏–≤–∞—Ç–Ω–∏–º–∏ –ø—ñ–¥–º–µ—Ä–µ–∂–∞–º–∏ (3 AZ)
- Internet Gateway
- NAT Gateway
- Route Tables

### 2. **ECR Module** (`./modules/ecr`)

–°—Ç–≤–æ—Ä—é—î Elastic Container Registry –∑:

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–º —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è–º –æ–±—Ä–∞–∑—ñ–≤
- –ü–æ–ª—ñ—Ç–∏–∫–æ—é –¥–æ—Å—Ç—É–ø—É
- –ü–æ–ª—ñ—Ç–∏–∫–æ—é –∂–∏—Ç—Ç—î–≤–æ–≥–æ —Ü–∏–∫–ª—É (–∑–±–µ—Ä—ñ–≥–∞—î –æ—Å—Ç–∞–Ω–Ω—ñ 30 –æ–±—Ä–∞–∑—ñ–≤)
- –¢–µ–≥—É–≤–∞–Ω–Ω—è–º —Ä–µ—Å—É—Ä—Å—ñ–≤

### 3. **S3 Backend Module** (`./modules/s3-backend`)

–ù–∞–ª–∞—à—Ç–æ–≤—É—î –≤—ñ–¥–¥–∞–ª–µ–Ω–∏–π —Å—Ç–∞–Ω Terraform:

- S3 –±–∞–∫–µ—Ç –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Å—Ç–∞–Ω—É
- DynamoDB —Ç–∞–±–ª–∏—Ü—è –¥–ª—è –±–ª–æ–∫—É–≤–∞–Ω–Ω—è
- –®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö

## üîß –ü–µ—Ä–µ–¥—É–º–æ–≤–∏

- [Terraform](https://www.terraform.io/downloads.html) >= 1.0
- [AWS CLI](https://aws.amazon.com/cli/) –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π
- AWS –∞–∫–∞—É–Ω—Ç –∑ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–º–∏ –ø—Ä–∞–≤–∞–º–∏
- Bash –∞–±–æ PowerShell

## ‚öôÔ∏è –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

### 1. –ö–ª–æ–Ω—É–≤–∞–Ω–Ω—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é

```bash
git clone <repository-url>
cd lesson-5
```

### 2. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è AWS

```bash
aws configure
# –í–≤–µ–¥—ñ—Ç—å –≤–∞—à—ñ AWS credentials
```

### 3. –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Terraform

```bash
terraform init
```

## üöÄ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### –ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω

```bash
terraform plan
```

### –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏

```bash
terraform apply
```

### –ü–µ—Ä–µ–≥–ª—è–¥ –≤–∏—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö

```bash
terraform output
```

### –í–∏–¥–∞–ª–µ–Ω–Ω—è —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏

```bash
terraform destroy
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É

```
lesson-7/
‚îú‚îÄ‚îÄ main.tf                 # –û—Å–Ω–æ–≤–Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
‚îú‚îÄ‚îÄ backend.tf              # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≤—ñ–¥–¥–∞–ª–µ–Ω–æ–≥–æ —Å—Ç–∞–Ω—É
‚îú‚îÄ‚îÄ outputs.tf              # –í–∏—Ö—ñ–¥–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è
‚îú‚îÄ‚îÄ README.md               # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è
‚îú‚îÄ‚îÄ .terraform/             # –ö–µ—à Terraform
‚îú‚îÄ‚îÄ terraform.tfstate       # –õ–æ–∫–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω (—è–∫—â–æ —î)
‚îî‚îÄ‚îÄ modules/                # –ú–æ–¥—É–ª—ñ
    ‚îú‚îÄ‚îÄ vpc/                # VPC –º–æ–¥—É–ª—å
    ‚îú‚îÄ‚îÄ ecr/                # ECR –º–æ–¥—É–ª—å
    ‚îî‚îÄ‚îÄ s3-backend/         # S3 Backend –º–æ–¥—É–ª—å
```

## üìä –í–∏—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ

–ü—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –≤–∏ –æ—Ç—Ä–∏–º–∞—î—Ç–µ:

| –í–∏—Ö—ñ–¥                 | –û–ø–∏—Å                      | –ü—Ä–∏–∫–ª–∞–¥                                                   |
| --------------------- | ------------------------- | --------------------------------------------------------- |
| `s3_bucket_name`      | –ù–∞–∑–≤–∞ S3 –±–∞–∫–µ—Ç–∞ –¥–ª—è —Å—Ç–∞–Ω—É | `podopryhora-goit-neoversity-tf-state-bucket`             |
| `dynamodb_table_name` | –ù–∞–∑–≤–∞ DynamoDB —Ç–∞–±–ª–∏—Ü—ñ    | `terraform-locks`                                         |
| `ecr_repository_url`  | URL ECR —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é       | `123456789012.dkr.ecr.us-east-1.amazonaws.com/django-app` |
| `ecr_repository_name` | –ù–∞–∑–≤–∞ ECR —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é     | `django-app`                                              |

## üöÄ –î–µ–ø–ª–æ–π Django –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É –∑ Helm (Lesson 7)

### 1. –ü–æ–±—É–¥–æ–≤–∞ —Ç–∞ –ø—É—à Docker-–æ–±—Ä–∞–∑—É

–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å, —â–æ –≤–∞—à –æ–±—Ä–∞–∑ –∑—ñ–±—Ä–∞–Ω–æ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ—ó –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏ (–∑–∞–∑–≤–∏—á–∞–π
`linux/amd64` –¥–ª—è EKS):

```sh
docker build --platform linux/amd64 -t <your-ecr-repo>:<tag> .
docker push <your-ecr-repo>:<tag>
```

–û–Ω–æ–≤—ñ—Ç—å `lesson-7/charts/values.yaml` –∑ –≤–∞—à–∏–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—î–º —Ç–∞ —Ç–µ–≥–æ–º –æ–±—Ä–∞–∑—É.

---

### 2. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö (–æ–ø—Ü—ñ–π–Ω–æ)

- –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º Django –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **SQLite** (–¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å –Ω–µ
  –ø–æ—Ç—Ä—ñ–±–Ω–æ).
- –î–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è PostgreSQL, –≤–∫–∞–∂—ñ—Ç—å —É `lesson-7/charts/values.yaml`:
  ```yaml
  config:
    POSTGRES_HOST: <your-db-host>
    POSTGRES_PORT: 5432
    POSTGRES_USER: <your-db-user>
    POSTGRES_DB: <your-db-name>
    POSTGRES_PASSWORD: <your-db-password>
  ```
  –Ø–∫—â–æ —Ü—ñ –∑–º—ñ–Ω–Ω—ñ –Ω–µ –∑–∞–¥–∞–Ω—ñ, –±—É–¥–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ SQLite.

---

### 3. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∞–±–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è Helm-—Ä–µ–ª—ñ–∑—É

```sh
helm install lesson-7 ./lesson-7/charts
# –∞–±–æ, —è–∫—â–æ –æ–Ω–æ–≤–ª—é—î—Ç–µ:
helm upgrade lesson-7 ./lesson-7/charts
```

---

### 4. –î–æ—Å—Ç—É–ø –¥–æ –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É

–ó–Ω–∞–π–¥—ñ—Ç—å –∞–¥—Ä–µ—Å—É LoadBalancer:

```sh
kubectl get svc
```

–í—ñ–¥–∫—Ä–∏–π—Ç–µ EXTERNAL-IP —É –±—Ä–∞—É–∑–µ—Ä—ñ (–ø–æ—Ä—Ç 80).

---

### 5. Horizontal Pod Autoscaler

–ó–∞—Å—Ç–æ—Å—É–Ω–æ–∫ –º–∞—Å—à—Ç–∞–±—É—î—Ç—å—Å—è –≤—ñ–¥ 2 –¥–æ 6 –ø–æ–¥—ñ–≤ –ø—Ä–∏ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ CPU > 70%.
–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —É `values.yaml` —Å–µ–∫—Ü—ñ—è `hpa:`.

---

### 6. Troubleshooting

- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ –ø–æ–¥–∞:
  ```sh
  kubectl logs <pod-name>
  ```
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ endpoints —Å–µ—Ä–≤—ñ—Å—É:
  ```sh
  kubectl describe svc lesson-7-loadbalancer-django
  ```

## üîí –ë–µ–∑–ø–µ–∫–∞

### –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏:

- ‚úÖ –®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è —Å—Ç–∞–Ω—É Terraform
- ‚úÖ –ë–ª–æ–∫—É–≤–∞–Ω–Ω—è —Å—Ç–∞–Ω—É —á–µ—Ä–µ–∑ DynamoDB
- ‚úÖ –û–±–º–µ–∂–µ–Ω–∏–π –¥–æ—Å—Ç—É–ø –¥–æ ECR
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è –æ–±—Ä–∞–∑—ñ–≤
- ‚úÖ –ü–æ–ª—ñ—Ç–∏–∫–∞ –∂–∏—Ç—Ç—î–≤–æ–≥–æ —Ü–∏–∫–ª—É

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó:

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ IAM —Ä–æ–ª—ñ –∑–∞–º—ñ—Å—Ç—å access keys
- –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–Ω–æ–≤–ª—é–π—Ç–µ Terraform —Ç–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∏
- –ú–æ–Ω—ñ—Ç–æ—Ä—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤
- –ù–∞–ª–∞—à—Ç—É–π—Ç–µ CloudTrail –¥–ª—è –∞—É–¥–∏—Ç—É

## üõ†Ô∏è –ü—ñ–¥—Ç—Ä–∏–º–∫–∞

### –ö–æ—Ä–∏—Å–Ω—ñ –∫–æ–º–∞–Ω–¥–∏:

```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É
terraform validate

# –§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è –∫–æ–¥—É
terraform fmt

# –ü–µ—Ä–µ–≥–ª—è–¥ –ø–ª–∞–Ω—É
terraform plan -out=tfplan

# –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –∑ —Ñ–∞–π–ª—É –ø–ª–∞–Ω—É
terraform apply tfplan

# –ü–µ—Ä–µ–≥–ª—è–¥ —Å—Ç–∞–Ω—É
terraform show
```

### –õ–æ–≥—É–≤–∞–Ω–Ω—è:

```bash
# –î–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è
export TF_LOG=DEBUG
terraform apply

# –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ª–æ–≥—ñ–≤ —É —Ñ–∞–π–ª
export TF_LOG_PATH=./terraform.log
```

## üìù –õ—ñ—Ü–µ–Ω–∑—ñ—è

–¶–µ–π –ø—Ä–æ–µ–∫—Ç —Å—Ç–≤–æ—Ä–µ–Ω–æ –¥–ª—è –Ω–∞–≤—á–∞–ª—å–Ω–∏—Ö —Ü—ñ–ª–µ–π.

---

**–ê–≤—Ç–æ—Ä:** [–ü–æ–¥–æ–ø—Ä–∏–≥–æ—Ä–∞ –ú–∏–∫–æ–ª–∞]  
**–í–µ—Ä—Å—ñ—è:** 0.0.7
